<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.manage.system.mapper.TUserMapper">
    <select id="getMember" resultType="com.shop.manage.system.vo.MemberResVo">
    select tu.member_level,
       tu.head_image_url,
       tu.fact_name,
       tu.id_card,
       tu.login_name,
       tu.nick_name,
       tu.contact_phone,
       tu.user_address,
       tu.id,
       tr.role_id,
       sg.org_id,
       sg.shop_id,
       ro.org_name roleName,
       og.org_name ,
       sp.shop_name
       from t_user tu
    inner join t_user_role tr
        on tu.id =tr.user_id
    inner join t_user_org tg
        on tu.id = tg.user_id
    inner join t_shop_org sg
        on sg.org_id = tg.org_id
    left join t_role ro
        on ro.id = tr.role_id and ro.is_available='1'
    left join t_org og
        on og.id= sg.org_id and og.is_available='1'
    left join t_shop sp
        on sp.id =sg.shop_id and sp.is_available='1'
    where tu.id = #{id} and tu.is_available='1'
    </select>

    <insert id="saveMember" useGeneratedKeys="true" keyProperty="id" parameterType="com.shop.manage.system.entity.TUser">
	INSERT INTO t_user
	 (login_name, nick_name, is_available, id_card, contact_phone
	 , fact_name, create_time, create_user, modify_time, modify_user, member_level, head_image_url,user_address)
	 VALUES (#{loginName}, #{nickName}, '1', #{idCard}, #{contactPhone}, #{factName},
	 #{createTime}, #{createUser}, #{modifyTime}, #{modifyUser}, #{memberLevel}, #{headImageUrl},#{userAddress})
    </insert>
</mapper>